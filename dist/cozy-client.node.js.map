{"version":3,"sources":["webpack:///webpack/bootstrap d3079fe8336b1630ec0f","webpack:///external \"isomorphic-fetch\"","webpack:///./src/index.js","webpack:///external \"core-js/modules/es6.object.assign\"","webpack:///./src/utils.js","webpack:///./src/auth_storage.js","webpack:///./src/auth_v2.js","webpack:///external \"btoa\"","webpack:///./src/auth_v3.js","webpack:///./src/fetch.js","webpack:///./src/jsonapi.js","webpack:///external \"crypto\"","webpack:///./src/data.js","webpack:///./src/doctypes.js","webpack:///./src/mango.js","webpack:///./src/files.js","webpack:///./src/intents.js","webpack:///./src/jobs.js","webpack:///./src/offline.js","webpack:///external \"pouchdb\"","webpack:///external \"pouchdb-find\"","webpack:///./src/settings.js","webpack:///./src/relations.js"],"names":["auth","data","cozyFetch","mango","files","intents","jobs","offline","settings","relations","AppTokenV3","AppToken","AccessTokenV3","AccessToken","ClientV3","Client","AuthNone","AuthRunning","AuthError","AuthOK","defaultClientParams","softwareID","dataProto","create","find","findMany","findAll","update","delete","_delete","updateAttributes","changesFeed","defineIndex","query","addReferencedFiles","removeReferencedFiles","listReferencedFiles","fetchReferencedFiles","destroy","authProto","client","registerClient","updateClient","unregisterClient","getClient","getAuthCodeURL","getAccessToken","refreshToken","filesProto","createDirectory","createDirectoryByPath","updateById","updateAttributesById","updateAttributesByPath","trashById","statById","statByPath","downloadById","downloadByPath","getDownloadLinkById","getDownloadLink","getDownloadLinkByPath","getArchiveLink","getArchiveLinkByPaths","getArchiveLinkByIds","getFilePath","getCollectionShareLink","queryFiles","listTrash","clearTrash","restoreById","destroyById","intentsProto","createService","jobsProto","count","queued","offlineProto","init","getDoctypes","hasDatabase","getDatabase","createDatabase","destroyDatabase","destroyAllDatabase","hasReplication","replicateFromCozy","stopReplication","stopAllReplication","hasRepeatedReplication","startRepeatedReplication","stopRepeatedReplication","stopAllRepeatedReplication","settingsProto","diskUsage","changePassphrase","getInstance","updateInstance","getClients","deleteClientById","updateLastSync","ensureHasReconnectParam","url","URL","_url","searchParams","has","append","search","indexOf","toString","options","AppTokenV2","LocalStorage","MemoryStorage","_inited","_oauth","_token","_authstate","_authcreds","_storage","_version","version","_offline","token","oauth","Error","storage","_clientParams","Object","assign","clientParams","_onRegistered","onRegistered","nopOnRegistered","cozyURL","length","slice","_invalidTokenErrorHandler","onInvalidTokenError","undefined","handleInvalidTokenError","disablePromises","addToProto","fetchJSON","_fetchJSON","args","concat","Array","prototype","call","arguments","cozyFetchJSON","apply","forceTokenRefresh","state","isV2","then","redirectURI","oauthFlow","Promise","resolve","creds","save","CredsKey","path","pathprefix","fetch","res","ok","json","status","datasystem","protoify","context","fn","prototyped","ctx","obj","proto","attr","module","exports","unpromiser","isPromise","isOnline","isOffline","sleep","retry","getFuzzedDelay","getBackedoffDelay","createPath","encodeQuery","decodeQuery","warn","FuzzFactor","value","l","cb","err","navigator","onLine","time","setTimeout","delay","doTry","catch","retryDelay","fuzzingFactor","Math","random","retryCount","pow","cozy","doctype","id","route","encodeURIComponent","q","qname","queryIndex","queries","fragIndex","queryStr","parts","split","i","pair","decodeURIComponent","hasOwnProperty","warned","text","push","console","prefix","window","localStorage","key","setItem","JSON","stringify","item","getItem","parse","removeItem","hash","deleted","getAppToken","V2TOKEN_ABORT_TIMEOUT","reject","parent","postMessage","origin","location","intent","action","timeout","receiver","event","appName","e","removeEventListener","clearTimeout","addEventListener","opts","btoa","StateSize","StateKey","clientID","client_id","clientSecret","client_secret","registrationAccessToken","registration_access_token","redirect_uris","software_id","softwareVersion","software_version","clientName","client_name","clientKind","client_kind","clientURI","client_uri","logoURI","logo_uri","policyURI","policy_uri","notificationPlatform","notification_platform","notificationDeviceToken","notification_device_token","tokenType","token_type","accessToken","access_token","refresh_token","scope","cli","isRegistered","toRegisterJSON","disableAuth","resetSecret","manualAuthCredentials","createClient","isUnauthorized","isNotFound","oldClient","newClient","shouldPassRegistration","scopes","generateRandomState","join","pageURL","grantQueries","getGrantCodeFromPageURL","retrieveToken","code","ignoreCachedCredentials","clear","tryCount","clearAndRetry","registerNewClient","all","load","credentials","storedState","statePromise","t","body","dontRetry","headers","href","buffer","crypto","getRandomValues","Uint8Array","require","randomBytes","floor","String","fromCharCode","replace","cozyFetchRawJSON","fullpath","resp","cozyFetchWithAuth","authorize","handleResponse","toAuthHeader","newToken","saveCredentials","method","processJSONAPI","handleJSONResponse","response","invalidTokenErrorHandler","contentType","get","error","FetchError","isInvalidToken","currentOrigin","requestUrl","redirectURL","reason","captureStackTrace","constructor","name","defineProperty","message","indexKey","doc","type","findByRef","resources","ref","handleResource","rawResource","links","resource","_id","_type","_rev","meta","rev","attributes","rels","relationships","isArray","map","handleTopLevel","included","forEach","r","NOREV","docType","httpVerb","ids","include_docs","keys","docs","rows","row","match","changes","tries","normalizeDoctype","DOCTYPE_FILES","KNOWN_DOCTYPES","REVERSE_KNOWN","k","isQualified","known","parseSelector","normalizeSelector","makeMapReduceQuery","fields","defineIndexV2","defineIndexV3","indexRef","queryV2","queryV3","getV3Options","wholeResponse","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","toLowerCase","emit","FIELDSPLACEHOLDER","COUCHDB_INFINITY","COUCHDB_LOWEST","indexName","capitalize","indexDefinition","makeMapFunction","reduce","indexResult","result","selector","use_index","limit","skip","since","sort","descending","f","charAt","toUpperCase","operator","acc","filters","filter","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","ROOT_DIR_ID","TRASH_DIR_ID","contentTypeOctetStream","sanitizeFileName","trim","getFileTypeFromName","test","doUpload","ArrayBuffer","isBuffer","isFile","File","isBlob","Blob","isStream","readable","pipe","isString","contentLength","checksum","lastModifiedDate","ifMatch","Date","toGMTString","dirID","executable","getDirectoryOrCreate","parentDirectory","parsedError","errors","part","rootDirectoryPromise","parentDirectoryPromise","doUpdateAttributes","attrs","db","children","sortFiles","addIsDir","toJsonApi","encodePageOptions","extractResponseLinkRelated","related","file","folder","folderPath","endsWith","collectionType","permissions","verbs","values","collection","sharecode","codes","email","paths","archive","isDir","contents","clone","allFiles","folders","a","b","localeCompare","intentClass","errorSerializer","mapErrorProperties","from","to","nativeProperties","property","serialize","deserialize","injectService","element","onReadyCallback","document","ownerDocument","defaultView","iframe","createElement","onload","setAttribute","classList","add","appendChild","focus","serviceOrigin","handshaken","messageHandler","eventType","source","transition","style","dimensions","prop","removeIntentFrame","parentNode","removeChild","first","arr","createPromise","start","filterServices","restData","services","filteredServices","service","listenClientData","messageEventListener","intentId","serviceWindow","terminated","terminate","resizeClient","transitionProperty","maxHeight","clientHeight","maxWidth","clientWidth","cancel","getData","getIntent","eventName","exposeIntentFrameRemoval","throw","workerType","setDatabase","replicationOfflineError","pluginLoaded","doctypes","getInfo","database","plugin","pouchdbAdapterCordovaSqlite","createIndexes","createIndex","index","getReplication","replication","setReplication","getReplicationUrl","basic","toBasicAuth","getReplicationPromise","replicationPromise","setReplicationPromise","promise","live","onError","replicate","on","info","onComplete","stop","getRepeatedReplication","interval","setRepeatedReplication","timer","setInterval","clearInterval","currentPassPhrase","newPassPhrase","current_passphrase","new_passphrase","instance","updateRelations","verb","refs","makeReferencesPath","params"],"mappings":"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","file":"cozy-client.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d3079fe8336b1630ec0f","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 1\n// module chunks = 0","/* global fetch URL */\nimport 'core-js/modules/es6.object.assign'\nimport {unpromiser, retry, warn} from './utils'\nimport {LocalStorage, MemoryStorage} from './auth_storage'\nimport {AppToken as AppTokenV2, getAppToken as getAppTokenV2} from './auth_v2'\nimport * as auth from './auth_v3'\nimport * as data from './data'\nimport * as cozyFetch from './fetch'\nimport * as mango from './mango'\nimport * as files from './files'\nimport * as intents from './intents'\nimport * as jobs from './jobs'\nimport * as offline from './offline'\nimport * as settings from './settings'\nimport * as relations from './relations'\n\nconst {\n  AppToken: AppTokenV3,\n  AccessToken: AccessTokenV3,\n  Client: ClientV3\n} = auth\n\nconst AuthNone = 0\nconst AuthRunning = 1\nconst AuthError = 2\nconst AuthOK = 3\n\nconst defaultClientParams = {\n  softwareID: 'github.com/cozy/cozy-client-js'\n}\n\nconst dataProto = {\n  create: data.create,\n  find: data.find,\n  findMany: data.findMany,\n  findAll: data.findAll,\n  update: data.update,\n  delete: data._delete,\n  updateAttributes: data.updateAttributes,\n  changesFeed: data.changesFeed,\n  defineIndex: mango.defineIndex,\n  query: mango.query,\n  addReferencedFiles: relations.addReferencedFiles,\n  removeReferencedFiles: relations.removeReferencedFiles,\n  listReferencedFiles: relations.listReferencedFiles,\n  fetchReferencedFiles: relations.fetchReferencedFiles,\n  destroy: function (...args) {\n    warn('destroy is deprecated, use cozy.data.delete instead.')\n    return data._delete(...args)\n  }\n}\n\nconst authProto = {\n  client: auth.client,\n  registerClient: auth.registerClient,\n  updateClient: auth.updateClient,\n  unregisterClient: auth.unregisterClient,\n  getClient: auth.getClient,\n  getAuthCodeURL: auth.getAuthCodeURL,\n  getAccessToken: auth.getAccessToken,\n  refreshToken: auth.refreshToken\n}\n\nconst filesProto = {\n  create: files.create,\n  createDirectory: files.createDirectory,\n  createDirectoryByPath: files.createDirectoryByPath,\n  updateById: files.updateById,\n  updateAttributesById: files.updateAttributesById,\n  updateAttributesByPath: files.updateAttributesByPath,\n  trashById: files.trashById,\n  statById: files.statById,\n  statByPath: files.statByPath,\n  downloadById: files.downloadById,\n  downloadByPath: files.downloadByPath,\n  getDownloadLinkById: files.getDownloadLinkById,\n  getDownloadLink: files.getDownloadLinkByPath, // DEPRECATED, should be removed very soon\n  getDownloadLinkByPath: files.getDownloadLinkByPath,\n  getArchiveLink: function (...args) {\n    warn('getArchiveLink is deprecated, use cozy.files.getArchiveLinkByPaths instead.')\n    return files.getArchiveLinkByPaths(...args)\n  },\n  getArchiveLinkByPaths: files.getArchiveLinkByPaths,\n  getArchiveLinkByIds: files.getArchiveLinkByIds,\n  getFilePath: files.getFilePath,\n  getCollectionShareLink: files.getCollectionShareLink,\n  query: mango.queryFiles,\n  listTrash: files.listTrash,\n  clearTrash: files.clearTrash,\n  restoreById: files.restoreById,\n  destroyById: files.destroyById\n}\n\nconst intentsProto = {\n  create: intents.create,\n  createService: intents.createService\n}\n\nconst jobsProto = {\n  create: jobs.create,\n  count: jobs.count,\n  queued: jobs.queued\n}\n\nconst offlineProto = {\n  init: offline.init,\n  getDoctypes: offline.getDoctypes,\n  // database\n  hasDatabase: offline.hasDatabase,\n  getDatabase: offline.getDatabase,\n  createDatabase: offline.createDatabase,\n  destroyDatabase: offline.destroyDatabase,\n  destroyAllDatabase: offline.destroyAllDatabase,\n  // replication\n  hasReplication: offline.hasReplication,\n  replicateFromCozy: offline.replicateFromCozy,\n  stopReplication: offline.stopReplication,\n  stopAllReplication: offline.stopAllReplication,\n  // repeated replication\n  hasRepeatedReplication: offline.hasRepeatedReplication,\n  startRepeatedReplication: offline.startRepeatedReplication,\n  stopRepeatedReplication: offline.stopRepeatedReplication,\n  stopAllRepeatedReplication: offline.stopAllRepeatedReplication\n}\n\nconst settingsProto = {\n  diskUsage: settings.diskUsage,\n  changePassphrase: settings.changePassphrase,\n  getInstance: settings.getInstance,\n  updateInstance: settings.updateInstance,\n  getClients: settings.getClients,\n  deleteClientById: settings.deleteClientById,\n  updateLastSync: settings.updateLastSync\n}\n\nconst ensureHasReconnectParam = _url => {\n  const url = new URL(_url)\n  if (url.searchParams && !url.searchParams.has('reconnect')) {\n    url.searchParams.append('reconnect', 1)\n  } else if (!url.search || url.search.indexOf('reconnect') === -1) {\n    // Some old navigators do not have the searchParams API\n    // and it is not polyfilled by babel-polyfill\n    url.search = url.search + '&reconnect=1'\n  }\n  return url.toString()\n}\n\nclass Client {\n  constructor (options) {\n    this.data = {}\n    this.files = {}\n    this.intents = {}\n    this.jobs = {}\n    this.offline = {}\n    this.settings = {}\n    this.auth = {\n      Client: ClientV3,\n      AccessToken: AccessTokenV3,\n      AppToken: AppTokenV3,\n      AppTokenV2: AppTokenV2,\n      LocalStorage: LocalStorage,\n      MemoryStorage: MemoryStorage\n    }\n    this._inited = false\n    if (options) {\n      this.init(options)\n    }\n  }\n\n  init (options = {}) {\n    this._inited = true\n    this._oauth = false // is oauth activated or not\n    this._token = null  // application token\n    this._authstate = AuthNone\n    this._authcreds = null\n    this._storage = null\n    this._version = options.version || null\n    this._offline = null\n\n    const token = options.token\n    const oauth = options.oauth\n    if (token && oauth) {\n      throw new Error('Cannot specify an application token with a oauth activated')\n    }\n\n    if (token) {\n      this._token = new AppTokenV3({ token })\n    } else if (oauth) {\n      this._oauth = true\n      this._storage = oauth.storage\n      this._clientParams = Object.assign({}, defaultClientParams, oauth.clientParams)\n      this._onRegistered = oauth.onRegistered || nopOnRegistered\n    }\n\n    let url = options.cozyURL || ''\n    while (url[url.length - 1] === '/') {\n      url = url.slice(0, -1)\n    }\n\n    this._url = url\n\n    this._invalidTokenErrorHandler = options.onInvalidTokenError !== undefined ? options.onInvalidTokenError : cozyFetch.handleInvalidTokenError\n\n    const disablePromises = !!options.disablePromises\n    addToProto(this, this.data, dataProto, disablePromises)\n    addToProto(this, this.auth, authProto, disablePromises)\n    addToProto(this, this.files, filesProto, disablePromises)\n    addToProto(this, this.intents, intentsProto, disablePromises)\n    addToProto(this, this.jobs, jobsProto, disablePromises)\n    addToProto(this, this.offline, offlineProto, disablePromises)\n    addToProto(this, this.settings, settingsProto, disablePromises)\n\n    if (options.offline) {\n      this.offline.init(options.offline)\n    }\n\n    // Exposing cozyFetchJSON to make some development easier. Should be temporary.\n    this.fetchJSON = function _fetchJSON () {\n      const args = [this].concat(Array.prototype.slice.call(arguments))\n      return cozyFetch.cozyFetchJSON.apply(this, args)\n    }\n  }\n\n  authorize (forceTokenRefresh = false) {\n    const state = this._authstate\n    if (state === AuthOK || state === AuthRunning) {\n      return this._authcreds\n    }\n\n    this._authstate = AuthRunning\n    this._authcreds = this.isV2().then((isV2) => {\n      if (isV2 && this._oauth) {\n        throw new Error('OAuth is not supported on the V2 stack')\n      }\n      if (this._oauth) {\n        if (forceTokenRefresh && this._clientParams.redirectURI) {\n          this._clientParams.redirectURI = ensureHasReconnectParam(this._clientParams.redirectURI)\n        }\n        return auth.oauthFlow(\n          this,\n          this._storage,\n          this._clientParams,\n          this._onRegistered,\n          forceTokenRefresh\n        )\n      }\n      // we expect to be on a client side application running in a browser\n      // with cookie-based authentication.\n      if (isV2) {\n        return getAppTokenV2()\n      } else if (this._token) {\n        return Promise.resolve({client: null, token: this._token})\n      } else {\n        throw new Error('Missing application token')\n      }\n    })\n\n    this._authcreds.then(\n      () => { this._authstate = AuthOK },\n      () => { this._authstate = AuthError })\n\n    return this._authcreds\n  }\n\n  saveCredentials (client, token) {\n    const creds = {client, token}\n    if (!this._storage || this._authstate === AuthRunning) {\n      return Promise.resolve(creds)\n    }\n    this._storage.save(auth.CredsKey, creds)\n    this._authcreds = Promise.resolve(creds)\n    return this._authcreds\n  }\n\n  fullpath (path) {\n    return this.isV2().then((isV2) => {\n      const pathprefix = isV2 ? '/ds-api' : ''\n      return this._url + pathprefix + path\n    })\n  }\n\n  isV2 () {\n    if (!this._version) {\n      return retry(() => fetch(`${this._url}/status/`), 3)()\n        .then((res) => {\n          if (!res.ok) {\n            throw new Error('Could not fetch cozy status')\n          } else {\n            return res.json()\n          }\n        })\n        .then((status) => {\n          this._version = status.datasystem !== undefined ? 2 : 3\n          return this.isV2()\n        })\n    }\n    return Promise.resolve(this._version === 2)\n  }\n}\n\nfunction nopOnRegistered () {\n  throw new Error('Missing onRegistered callback')\n}\n\nfunction protoify (context, fn) {\n  return function prototyped (...args) {\n    return fn(context, ...args)\n  }\n}\n\nfunction addToProto (ctx, obj, proto, disablePromises) {\n  for (const attr in proto) {\n    let fn = protoify(ctx, proto[attr])\n    if (disablePromises) {\n      fn = unpromiser(fn)\n    }\n    obj[attr] = fn\n  }\n}\n\nmodule.exports = new Client()\nObject.assign(module.exports, {Client, LocalStorage, MemoryStorage})\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"core-js/modules/es6.object.assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.object.assign\"\n// module id = 3\n// module chunks = 0","/* global navigator */\nconst FuzzFactor = 0.3\n\nexport function unpromiser (fn) {\n  return function (...args) {\n    const value = fn.apply(this, args)\n    if (!isPromise(value)) {\n      return value\n    }\n    const l = args.length\n    if (l === 0 || typeof args[l - 1] !== 'function') {\n      return\n    }\n    const cb = args[l - 1]\n    value.then(\n      (res) => cb(null, res),\n      (err) => cb(err, null)\n    )\n  }\n}\n\nexport function isPromise (value) {\n  return !!value && typeof value.then === 'function'\n}\n\nexport function isOnline () {\n  return typeof navigator !== 'undefined' ? navigator.onLine : true\n}\n\nexport function isOffline () {\n  return !isOnline()\n}\n\nexport function sleep (time, args) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, time, args)\n  })\n}\n\nexport function retry (fn, count, delay = 300) {\n  return function doTry (...args) {\n    return fn(...args).catch((err) => {\n      if (--count < 0) {\n        throw err\n      }\n      return sleep(getBackedoffDelay(delay, count))\n        .then(() => doTry(...args))\n    })\n  }\n}\n\nexport function getFuzzedDelay (retryDelay) {\n  const fuzzingFactor = ((Math.random() * 2) - 1) * FuzzFactor\n  return retryDelay * (1.0 + fuzzingFactor)\n}\n\nexport function getBackedoffDelay (retryDelay, retryCount = 1) {\n  return getFuzzedDelay(retryDelay * Math.pow(2, retryCount - 1))\n}\n\nexport function createPath (cozy, isV2, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!isV2) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  const q = encodeQuery(query)\n  if (q !== '') {\n    route += '?' + q\n  }\n  return route\n}\n\nexport function encodeQuery (query) {\n  if (!query) {\n    return ''\n  }\n  let q = ''\n  for (const qname in query) {\n    if (q !== '') {\n      q += '&'\n    }\n    q += `${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`\n  }\n  return q\n}\n\nexport function decodeQuery (url) {\n  let queryIndex = url.indexOf('?')\n  if (queryIndex < 0) {\n    queryIndex = url.length\n  }\n  const queries = {}\n  let fragIndex = url.indexOf('#')\n  if (fragIndex < 0) {\n    fragIndex = url.length\n  }\n  if (fragIndex < queryIndex) {\n    return queries\n  }\n  const queryStr = url.slice(queryIndex + 1, fragIndex)\n  if (queryStr === '') {\n    return queries\n  }\n  const parts = queryStr.split('&')\n  for (let i = 0; i < parts.length; i++) {\n    let pair = parts[i].split('=')\n    if (pair.length === 0 || pair[0] === '') {\n      continue\n    }\n    const qname = decodeURIComponent(pair[0])\n    if (queries.hasOwnProperty(qname)) {\n      continue\n    }\n    if (pair.length === 1) {\n      queries[qname] = true\n    } else if (pair.length === 2) {\n      queries[qname] = decodeURIComponent(pair[1])\n    } else {\n      throw new Error('Malformed URL')\n    }\n  }\n  return queries\n}\n\nconst warned = []\nexport function warn (text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.warn('cozy-client-js', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","export class LocalStorage {\n  constructor (storage, prefix) {\n    if (!storage && typeof window !== 'undefined') {\n      storage = window.localStorage\n    }\n    this.storage = storage\n    this.prefix = prefix || 'cozy:oauth:'\n  }\n\n  save (key, value) {\n    return new Promise(resolve => {\n      this.storage.setItem(this.prefix + key, JSON.stringify(value))\n      resolve(value)\n    })\n  }\n\n  load (key) {\n    return new Promise(resolve => {\n      const item = this.storage.getItem(this.prefix + key)\n      if (!item) {\n        resolve()\n      } else {\n        resolve(JSON.parse(item))\n      }\n    })\n  }\n\n  delete (key) {\n    return new Promise(resolve => resolve(\n      this.storage.removeItem(this.prefix + key)))\n  }\n\n  clear () {\n    return new Promise(resolve => {\n      const storage = this.storage\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i)\n        if (key.indexOf(this.prefix) === 0) {\n          storage.removeItem(key)\n        }\n      }\n      resolve()\n    })\n  }\n}\n\nexport class MemoryStorage {\n  constructor () {\n    this.hash = Object.create(null)\n  }\n\n  save (key, value) {\n    this.hash[key] = value\n    return Promise.resolve(value)\n  }\n\n  load (key) {\n    return Promise.resolve(this.hash[key])\n  }\n\n  delete (key) {\n    const deleted = delete this.hash[key]\n    return Promise.resolve(deleted)\n  }\n\n  clear () {\n    this.hash = Object.create(null)\n    return Promise.resolve()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_storage.js","/* global btoa */\nconst V2TOKEN_ABORT_TIMEOUT = 3000\n\nexport function getAppToken () {\n  return new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      return reject(new Error('getV2Token should be used in browser'))\n    } else if (!window.parent) {\n      return reject(new Error('getV2Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      return reject(new Error('getV2Token should be used in modern browser'))\n    }\n    const origin = window.location.origin\n    const intent = {action: 'getToken'}\n    let timeout = null\n    const receiver = function (event) {\n      let token\n      try {\n        token = new AppToken({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      } catch (e) {\n        reject(e)\n        return\n      }\n      window.removeEventListener('message', receiver)\n      clearTimeout(timeout)\n      resolve({ client: null, token })\n    }\n    window.addEventListener('message', receiver, false)\n    window.parent.postMessage(intent, origin)\n    timeout = setTimeout(() => {\n      reject(new Error('No response from parent iframe after 3s'))\n    }, V2TOKEN_ABORT_TIMEOUT)\n  })\n}\n\nexport class AppToken {\n  constructor (opts) {\n    this.appName = opts.appName || ''\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader () {\n    return 'Basic ' + btoa(`${this.appName}:${this.token}`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v2.js","module.exports = require(\"btoa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"btoa\"\n// module id = 7\n// module chunks = 0","/* global btoa */\nimport {encodeQuery, decodeQuery, isOffline} from './utils'\nimport {cozyFetchJSON, FetchError} from './fetch'\n\nconst StateSize = 16\n\nexport const CredsKey = 'creds'\nexport const StateKey = 'state'\n\nexport class Client {\n  constructor (opts) {\n    this.clientID = opts.clientID || opts.client_id || ''\n    this.clientSecret = opts.clientSecret || opts.client_secret || ''\n    this.registrationAccessToken = opts.registrationAccessToken || opts.registration_access_token || ''\n\n    if (opts.redirect_uris) {\n      this.redirectURI = opts.redirect_uris[0] || ''\n    } else {\n      this.redirectURI = opts.redirectURI || ''\n    }\n\n    this.softwareID = opts.softwareID || opts.software_id || ''\n    this.softwareVersion = opts.softwareVersion || opts.software_version || ''\n    this.clientName = opts.clientName || opts.client_name || ''\n    this.clientKind = opts.clientKind || opts.client_kind || ''\n    this.clientURI = opts.clientURI || opts.client_uri || ''\n\n    this.logoURI = opts.logoURI || opts.logo_uri || ''\n    this.policyURI = opts.policyURI || opts.policy_uri || ''\n\n    this.notificationPlatform = opts.notificationPlatform || opts.notification_platform || ''\n    this.notificationDeviceToken = opts.notificationDeviceToken || opts.notification_device_token || ''\n\n    if (!this.registrationAccessToken) {\n      if (this.redirectURI === '') {\n        throw new Error('Missing redirectURI field')\n      }\n      if (this.softwareID === '') {\n        throw new Error('Missing softwareID field')\n      }\n      if (this.clientName === '') {\n        throw new Error('Missing clientName field')\n      }\n    }\n  }\n\n  isRegistered () {\n    return this.clientID !== ''\n  }\n\n  toRegisterJSON () {\n    return {\n      redirect_uris: [this.redirectURI],\n      software_id: this.softwareID,\n      software_version: this.softwareVersion,\n      client_name: this.clientName,\n      client_kind: this.clientKind,\n      client_uri: this.clientURI,\n      logo_uri: this.logoURI,\n      policy_uri: this.policyURI,\n      notification_platform: this.notificationPlatform,\n      notification_device_token: this.notificationDeviceToken\n    }\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.registrationAccessToken\n  }\n}\n\nexport class AccessToken {\n  constructor (opts) {\n    this.tokenType = opts.tokenType || opts.token_type\n    this.accessToken = opts.accessToken || opts.access_token\n    this.refreshToken = opts.refreshToken || opts.refresh_token\n    this.scope = opts.scope\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.accessToken\n  }\n\n  toBasicAuth () {\n    return `user:${this.accessToken}@`\n  }\n}\n\nexport class AppToken {\n  constructor (opts) {\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.token\n  }\n\n  toBasicAuth () {\n    return `user:${this.token}@`\n  }\n}\n\nexport function client (cozy, clientParams) {\n  if (!clientParams) {\n    clientParams = cozy._clientParams\n  }\n  if (clientParams instanceof Client) {\n    return clientParams\n  }\n  return new Client(clientParams)\n}\n\nexport function registerClient (cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (cli.isRegistered()) {\n    return Promise.reject(new Error('Client already registered'))\n  }\n  return cozyFetchJSON(cozy, 'POST', '/auth/register', cli.toRegisterJSON(), {\n    disableAuth: true\n  })\n    .then((data) => new Client(data))\n}\n\nexport function updateClient (cozy, clientParams, resetSecret = false) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  let data = cli.toRegisterJSON()\n  data.client_id = cli.clientID\n  if (resetSecret) data.client_secret = cli.clientSecret\n\n  return cozyFetchJSON(cozy, 'PUT', `/auth/register/${cli.clientID}`, data, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  }).then((data) => createClient(data, cli))\n}\n\nexport function unregisterClient (cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/auth/register/${cli.clientID}`, null, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  })\n}\n\n// getClient will retrive the registered client informations from the server.\nexport function getClient (cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  if (isOffline()) {\n    return Promise.resolve(cli)\n  }\n  return cozyFetchJSON(cozy, 'GET', `/auth/register/${cli.clientID}`, null,\n    {\n      manualAuthCredentials: {\n        token: cli\n      }\n    })\n    .then((data) => createClient(data, cli))\n    .catch((err) => {\n      // If we fall into an error while fetching the client (because of a\n      // bad connectivity for instance), we do not bail the whole process\n      // since the client should be able to continue with the persisted\n      // client and token.\n      //\n      // If it is an explicit Unauthorized error though, we bail, clear th\n      // cache and retry.\n      if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n        throw new Error('Client has been revoked')\n      }\n      throw err\n    })\n}\n\n// createClient returns a new Client instance given on object containing the\n// data of the client, from the API, and an old instance of the client.\nfunction createClient (data, oldClient) {\n  const newClient = new Client(data)\n  // we need to keep track of the registrationAccessToken since it is send\n  // only on registration. The GET /auth/register/:client-id endpoint does\n  // not return this token.\n  const shouldPassRegistration = (\n    !!oldClient &&\n    oldClient.registrationAccessToken !== '' &&\n    newClient.registrationAccessToken === ''\n  )\n  if (shouldPassRegistration) {\n    newClient.registrationAccessToken = oldClient.registrationAccessToken\n  }\n  return newClient\n}\n\n// getAuthCodeURL returns a pair {authURL,state} given a registered client. The\n// state should be stored in order to be checked against on the user validation\n// phase.\nexport function getAuthCodeURL (cozy, client, scopes = []) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    throw new Error('Client not registered')\n  }\n  const state = generateRandomState()\n  const query = {\n    'client_id': client.clientID,\n    'redirect_uri': client.redirectURI,\n    'state': state,\n    'response_type': 'code',\n    'scope': scopes.join(' ')\n  }\n  return {\n    url: cozy._url + `/auth/authorize?${encodeQuery(query)}`,\n    state: state\n  }\n}\n\n// getAccessToken perform a request on the access_token entrypoint with the\n// authorization_code grant type in order to generate a new access token for a\n// newly registered client.\n//\n// This method extracts the access code and state from the given URL. By\n// default it uses window.location.href. Also, it checks the given state with\n// the one specified in the URL query parameter to prevent CSRF attacks.\nexport function getAccessToken (cozy, client, state, pageURL = '') {\n  if (!state) {\n    return Promise.reject(new Error('Missing state value'))\n  }\n  const grantQueries = getGrantCodeFromPageURL(pageURL)\n  if (grantQueries === null) {\n    return Promise.reject(new Error('Missing states from current URL'))\n  }\n  if (state !== grantQueries.state) {\n    return Promise.reject(new Error('Given state does not match url query state'))\n  }\n  return retrieveToken(cozy, client, null, {\n    'grant_type': 'authorization_code',\n    'code': grantQueries.code\n  })\n}\n\n// refreshToken perform a request on the access_token entrypoint with the\n// refresh_token grant type in order to refresh the given token.\nexport function refreshToken (cozy, client, token) {\n  return retrieveToken(cozy, client, token, {\n    'grant_type': 'refresh_token',\n    'refresh_token': token.refreshToken\n  })\n}\n\n// oauthFlow performs the stateful registration and access granting of an OAuth\n// client.\nexport function oauthFlow (cozy, storage, clientParams, onRegistered, ignoreCachedCredentials = false) {\n  if (ignoreCachedCredentials) {\n    return storage.clear().then(() => oauthFlow(cozy, storage, clientParams, onRegistered, false))\n  }\n\n  let tryCount = 0\n\n  function clearAndRetry (err) {\n    if (tryCount++ > 0) {\n      throw err\n    }\n    return storage.clear().then(() =>\n      oauthFlow(cozy, storage, clientParams, onRegistered))\n  }\n\n  function registerNewClient () {\n    return storage.clear()\n      .then(() => registerClient(cozy, clientParams))\n      .then((client) => {\n        const {url, state} = getAuthCodeURL(cozy, client, clientParams.scopes)\n        return storage.save(StateKey, {client, url, state})\n      })\n  }\n\n  return Promise.all([\n    storage.load(CredsKey),\n    storage.load(StateKey)\n  ]).then(([credentials, storedState]) => {\n    // If credentials are cached we re-fetch the registered client with the\n    // said token. Fetching the client, if the token is outdated we should try\n    // the token is refreshed.\n    if (credentials) {\n      let oldClient, token\n      try {\n        oldClient = new Client(credentials.client)\n        token = new AccessToken(credentials.token)\n      } catch (err) {\n        // bad cache, we should clear and retry the process\n        return clearAndRetry(err)\n      }\n      return getClient(cozy, oldClient)\n        .then((client) => ({client, token}))\n        .catch((err) => {\n          // If we fall into an error while fetching the client (because of a\n          // bad connectivity for instance), we do not bail the whole process\n          // since the client should be able to continue with the persisted\n          // client and token.\n          //\n          // If it is an explicit Unauthorized error though, we bail, clear th\n          // cache and retry.\n          if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n            throw new Error('Client has been revoked')\n          }\n          return { client: oldClient, token }\n        })\n    }\n\n    // Otherwise register a new client if necessary (ie. no client is stored)\n    // and call the onRegistered callback to wait for the user to grant the\n    // access. Finally fetches to access token on success.\n    let statePromise\n    if (!storedState) {\n      statePromise = registerNewClient()\n    } else {\n      statePromise = Promise.resolve(storedState)\n    }\n\n    let client, state, token\n    return statePromise\n      .then((data) => {\n        client = data.client\n        state = data.state\n        return Promise.resolve(onRegistered(client, data.url))\n      })\n      .then((pageURL) => getAccessToken(cozy, client, state, pageURL))\n      .then((t) => { token = t })\n      .then(() => storage.delete(StateKey))\n      .then(() => ({client, token}))\n  })\n  .then(\n    (creds) => storage.save(CredsKey, creds),\n    (err) => {\n      if (FetchError.isUnauthorized(err)) {\n        return clearAndRetry(err)\n      } else {\n        throw err\n      }\n    })\n}\n\n// retrieveToken perform a request on the access_token entrypoint in order to\n// fetch a token.\nfunction retrieveToken (cozy, client, token, query) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  const body = encodeQuery(Object.assign({}, query, {\n    'client_id': client.clientID,\n    'client_secret': client.clientSecret\n  }))\n  return cozyFetchJSON(cozy, 'POST', '/auth/access_token', body, {\n    disableAuth: (token === null),\n    dontRetry: true,\n    manualAuthCredentials: { client, token },\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\n  })\n    .then((data) => {\n      data.refreshToken = data.refreshToken || query.refresh_token\n      return new AccessToken(data)\n    })\n}\n\n// getGrantCodeFromPageURL extract the state and access_code query parameters\n// from the given url\nfunction getGrantCodeFromPageURL (pageURL = '') {\n  if (pageURL === '' && typeof window !== 'undefined') {\n    pageURL = window.location.href\n  }\n  const queries = decodeQuery(pageURL)\n  if (!queries.hasOwnProperty('state')) {\n    return null\n  }\n  return {\n    state: queries['state'],\n    code: queries['access_code']\n  }\n}\n\n// generateRandomState will try to generate a 128bits random value from a secure\n// pseudo random generator. It will fallback on Math.random if it cannot find\n// such generator.\nfunction generateRandomState () {\n  let buffer\n  if (typeof window !== 'undefined' &&\n      typeof window.crypto !== 'undefined' &&\n      typeof window.crypto.getRandomValues === 'function') {\n    buffer = new Uint8Array(StateSize)\n    window.crypto.getRandomValues(buffer)\n  } else {\n    try {\n      buffer = require('crypto').randomBytes(StateSize)\n    } catch (e) {}\n  }\n  if (!buffer) {\n    buffer = new Array(StateSize)\n    for (let i = 0; i < buffer.length; i++) {\n      buffer[i] = Math.floor((Math.random() * 255))\n    }\n  }\n  return btoa(String.fromCharCode.apply(null, buffer))\n    .replace(/=+$/, '')\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v3.js","/* global fetch */\nimport {refreshToken, AccessToken} from './auth_v3'\nimport {retry, encodeQuery} from './utils'\nimport jsonapi from './jsonapi'\n\nexport function cozyFetch (cozy, path, options = {}) {\n  return cozy.fullpath(path).then((fullpath) => {\n    let resp\n    if (options.disableAuth) {\n      resp = fetch(fullpath, options)\n    } else if (options.manualAuthCredentials) {\n      resp = cozyFetchWithAuth(cozy, fullpath, options, options.manualAuthCredentials)\n    } else {\n      resp = cozy.authorize().then((credentials) =>\n        cozyFetchWithAuth(cozy, fullpath, options, credentials))\n    }\n    return resp.then(res => handleResponse(res, cozy._invalidTokenErrorHandler))\n  })\n}\n\nfunction cozyFetchWithAuth (cozy, fullpath, options, credentials) {\n  if (credentials) {\n    options.headers = options.headers || {}\n    options.headers['Authorization'] = credentials.token.toAuthHeader()\n  }\n\n  // the option credentials:include tells fetch to include the cookies in the\n  // request even for cross-origin requests\n  options.credentials = 'include'\n\n  return Promise.all([\n    cozy.isV2(),\n    fetch(fullpath, options)\n  ]).then(([isV2, res]) => {\n    if ((res.status !== 400 && res.status !== 401) || isV2 || !credentials || options.dontRetry) {\n      return res\n    }\n    // we try to refresh the token only for OAuth, ie, the client defined\n    // and the token is an instance of AccessToken.\n    const { client, token } = credentials\n    if (!client || !(token instanceof AccessToken)) {\n      return res\n    }\n    options.dontRetry = true\n    return retry(() => refreshToken(cozy, client, token), 3)()\n      .then((newToken) => cozy.saveCredentials(client, newToken))\n      .then((credentials) => cozyFetchWithAuth(cozy, fullpath, options, credentials))\n  })\n}\n\nexport function cozyFetchJSON (cozy, method, path, body, options = {}) {\n  const processJSONAPI = typeof options.processJSONAPI === 'undefined' || options.processJSONAPI\n  return fetchJSON(cozy, method, path, body, options)\n    .then(response => handleJSONResponse(response, processJSONAPI))\n}\n\nexport function cozyFetchRawJSON (cozy, method, path, body, options = {}) {\n  return fetchJSON(cozy, method, path, body, options)\n    .then(response => handleJSONResponse(response, false))\n}\n\nfunction fetchJSON (cozy, method, path, body, options = {}) {\n  options.method = method\n\n  const headers = options.headers = options.headers || {}\n\n  headers['Accept'] = 'application/json'\n\n  if (method !== 'GET' && method !== 'HEAD' && body !== undefined) {\n    if (headers['Content-Type']) {\n      options.body = body\n    } else {\n      headers['Content-Type'] = 'application/json'\n      options.body = JSON.stringify(body)\n    }\n  }\n\n  return cozyFetch(cozy, path, options)\n}\n\nfunction handleResponse (res, invalidTokenErrorHandler) {\n  if (res.ok) {\n    return res\n  }\n  let data\n  const contentType = res.headers.get('content-type')\n  if (contentType && contentType.indexOf('json') >= 0) {\n    data = res.json()\n  } else {\n    data = res.text()\n  }\n  return data.then(err => {\n    const error = new FetchError(res, err)\n    if (FetchError.isInvalidToken(error) && invalidTokenErrorHandler) {\n      invalidTokenErrorHandler(error)\n    }\n    throw error\n  })\n}\n\nfunction handleJSONResponse (res, processJSONAPI = true) {\n  const contentType = res.headers.get('content-type')\n  if (!contentType || contentType.indexOf('json') < 0) {\n    return res.text((data) => {\n      throw new FetchError(res, new Error('Response is not JSON: ' + data))\n    })\n  }\n\n  const json = res.json()\n  if (contentType.indexOf('application/vnd.api+json') === 0 && processJSONAPI) {\n    return json.then(jsonapi)\n  } else {\n    return json\n  }\n}\n\nexport function handleInvalidTokenError (error) {\n  try {\n    const currentOrigin = window.location.origin\n    const requestUrl = error.url\n\n    if (requestUrl.indexOf(currentOrigin.replace(/^(https?:\\/\\/\\w+)-\\w+\\./, '$1.')) === 0) {\n      const redirectURL = `${currentOrigin}?${encodeQuery({ 'disconnect': 1 })}`\n      window.location = redirectURL\n    }\n  } catch (e) {\n    console.warn('Unable to handle invalid token error', e, error)\n  }\n}\n\nexport class FetchError extends Error {\n  constructor (res, reason) {\n    super()\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor)\n    }\n    // XXX We have to hardcode this because babel doesn't play nice when extending Error\n    this.name = 'FetchError'\n    this.response = res\n    this.url = res.url\n    this.status = res.status\n    this.reason = reason\n\n    Object.defineProperty(this, 'message', {\n      value: reason.message ||\n        (typeof reason === 'string' ? reason : JSON.stringify(reason))\n    })\n  }\n}\n\nFetchError.isUnauthorized = function (err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 401\n}\n\nFetchError.isNotFound = function (err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 404\n}\n\nFetchError.isInvalidToken = function (err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 400 && err.reason && (err.reason.error === 'Invalid JWT token' || err.reason.error === 'Expired token')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/fetch.js","function indexKey (doc) {\n  return doc.type + '/' + doc.id\n}\n\nfunction findByRef (resources, ref) {\n  return resources[indexKey(ref)]\n}\n\nfunction handleResource (rawResource, resources, links) {\n  let resource = {\n    _id: rawResource.id,\n    _type: rawResource.type,\n    _rev: (rawResource.meta && rawResource.meta.rev),\n    links: Object.assign({}, rawResource.links, links),\n    attributes: rawResource.attributes,\n    relations: (name) => {\n      let rels = rawResource.relationships[name]\n      if (rels === undefined || rels.data === undefined) return undefined\n      if (rels.data === null) return null\n      if (!Array.isArray(rels.data)) return findByRef(resources, rels.data)\n      return rels.data.map(ref => findByRef(resources, ref))\n    }\n  }\n  if (rawResource.relationships) {\n    resource.relationships = rawResource.relationships\n  }\n\n  resources[indexKey(rawResource)] = resource\n\n  return resource\n}\n\nfunction handleTopLevel (doc, resources = {}) {\n  // build an index of included resource by Type & ID\n  const included = doc.included\n\n  if (Array.isArray(included)) {\n    included.forEach((r) => handleResource(r, resources, doc.links))\n  }\n\n  if (Array.isArray(doc.data)) {\n    return doc.data.map((r) => handleResource(r, resources, doc.links))\n  } else {\n    return handleResource(doc.data, resources, doc.links)\n  }\n}\n\nexport default handleTopLevel\n\n\n\n// WEBPACK FOOTER //\n// ./src/jsonapi.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 11\n// module chunks = 0","import {createPath} from './utils'\nimport {normalizeDoctype} from './doctypes'\nimport {cozyFetchJSON} from './fetch'\n\nconst NOREV = 'stack-v2-no-rev'\n\nexport function create (cozy, doctype, attributes) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (isV2) {\n      attributes.docType = doctype\n    }\n    const path = createPath(cozy, isV2, doctype, attributes._id)\n    const httpVerb = attributes._id ? 'PUT' : 'POST'\n    delete attributes._id\n    return cozyFetchJSON(cozy, httpVerb, path, attributes).then((resp) => {\n      if (isV2) {\n        return find(cozy, doctype, resp._id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function find (cozy, doctype, id) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n\n    if (!id) {\n      return Promise.reject(new Error('Missing id parameter'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, id)\n    return cozyFetchJSON(cozy, 'GET', path).then((resp) => {\n      if (isV2) {\n        return Object.assign(resp, {_rev: NOREV})\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\nexport function findMany (cozy, doctype, ids) {\n  if (!(ids instanceof Array)) {\n    return Promise.reject(new Error('Parameter ids must be a non-empty array'))\n  }\n  if (ids.length === 0) {\n    // So users don't need to be defensive regarding the array content.\n    // This should not hide issues in user code since the result will be an\n    // empty object anyway.\n    return Promise.resolve({})\n  }\n\n  return cozy.isV2().then((isV2) => {\n    if (isV2) {\n      return Promise.reject(new Error('findMany is not available on v2'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, '_all_docs', {include_docs: true})\n\n    return cozyFetchJSON(cozy, 'POST', path, {keys: ids})\n      .then((resp) => {\n        const docs = {}\n\n        for (const row of resp.rows) {\n          const {key, doc, error} = row\n          docs[key] = error ? {error} : {doc}\n        }\n\n        return docs\n      })\n      .catch((error) => {\n        if (error.status !== 404) return Promise.reject(error)\n\n        // When no doc was ever created and the database does not exist yet,\n        // the response will be a 404 error.\n        const docs = {}\n\n        for (const id of ids) {\n          docs[id] = {error}\n        }\n\n        return docs\n      })\n  })\n}\n\nexport function findAll (cozy, doctype) {\n  return cozy.isV2().then((isV2) => {\n    if (isV2) {\n      return Promise.reject(new Error('findAll is not available on v2'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, '_all_docs', {include_docs: true})\n\n    return cozyFetchJSON(cozy, 'POST', path, {})\n    .then((resp) => {\n      const docs = []\n\n      for (const row of resp.rows) {\n        const { doc } = row\n        // if not couchDB indexes\n        if (!doc._id.match(/_design\\//)) docs.push(doc)\n      }\n      return docs\n    })\n    .catch(error => {\n      // the _all_docs endpoint returns a 404 error if no document with the given\n      // doctype exists.\n      if (error.status === 404) return []\n      throw error\n    })\n  })\n}\n\nexport function changesFeed (cozy, doctype, options) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const path = createPath(cozy, isV2, doctype, '_changes', options)\n    return cozyFetchJSON(cozy, 'GET', path)\n  })\n}\n\nexport function update (cozy, doctype, doc, changes) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const {_id, _rev} = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    if (isV2) {\n      changes = Object.assign({ _id }, changes)\n    } else {\n      changes = Object.assign({ _id, _rev }, changes)\n    }\n\n    const path = createPath(cozy, isV2, doctype, _id)\n    return cozyFetchJSON(cozy, 'PUT', path, changes).then((resp) => {\n      if (isV2) {\n        return find(cozy, doctype, _id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function updateAttributes (cozy, doctype, _id, changes, tries = 3) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    return find(cozy, doctype, _id)\n      .then((doc) => {\n        return update(cozy, doctype, doc, Object.assign({ _id }, doc, changes))\n      })\n      .catch((err) => {\n        if (tries > 0) {\n          return updateAttributes(cozy, doctype, _id, changes, tries - 1)\n        } else {\n          throw err\n        }\n      })\n  })\n}\n\nexport function _delete (cozy, doctype, doc) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const {_id, _rev} = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    const query = isV2 ? null : { rev: _rev }\n    const path = createPath(cozy, isV2, doctype, _id, query)\n    return cozyFetchJSON(cozy, 'DELETE', path).then((resp) => {\n      if (isV2) {\n        return {id: _id, rev: NOREV}\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/data.js","import {warn} from './utils'\n\nexport const DOCTYPE_FILES = 'io.cozy.files'\n\nconst KNOWN_DOCTYPES = {\n  'files': DOCTYPE_FILES,\n  'folder': DOCTYPE_FILES,\n  'contact': 'io.cozy.contacts',\n  'event': 'io.cozy.events',\n  'track': 'io.cozy.labs.music.track',\n  'playlist': 'io.cozy.labs.music.playlist'\n}\n\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => {\n  REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k\n})\n\nexport function normalizeDoctype (cozy, isV2, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (isV2 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (!isV2 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn('you are using a non-qualified doctype ' + doctype + ' assumed to be ' + known)\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/doctypes.js","import {warn, createPath, sleep} from './utils'\nimport {normalizeDoctype} from './doctypes'\nimport {cozyFetchJSON, cozyFetchRawJSON} from './fetch'\n\nexport function defineIndex (cozy, doctype, fields) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (!Array.isArray(fields) || fields.length === 0) {\n      throw new Error('defineIndex fields should be a non-empty array')\n    }\n    if (isV2) {\n      return defineIndexV2(cozy, doctype, fields)\n    } else {\n      return defineIndexV3(cozy, doctype, fields)\n    }\n  })\n}\n\nexport function query (cozy, indexRef, options) {\n  return cozy.isV2().then((isV2) => {\n    if (!indexRef) {\n      throw new Error('query should be passed the indexRef')\n    }\n    if (isV2) {\n      return queryV2(cozy, indexRef, options)\n    } else {\n      return queryV3(cozy, indexRef, options)\n    }\n  })\n}\n\nexport function queryFiles (cozy, indexRef, options) {\n  const opts = getV3Options(indexRef, options)\n  return cozyFetchRawJSON(cozy, 'POST', '/files/_find', opts)\n    .then((response) => options.wholeResponse ? response : response.docs)\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = (function (doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER'){\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}).toString().replace(/ /g, '').replace(/\\n/g, '')\nconst COUCHDB_INFINITY = {\"\\uFFFF\": \"\\uFFFF\"}\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV2 (cozy, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = { map: makeMapFunction(doctype, fields), reduce: '_count' }\n  let path = `/request/${doctype}/${indexName}/`\n  return cozyFetchJSON(cozy, 'PUT', path, indexDefinition)\n    .then(() => ({ doctype: doctype, type: 'mapreduce', name: indexName, fields: fields }))\n}\n\nfunction defineIndexV3 (cozy, doctype, fields) {\n  let path = createPath(cozy, false, doctype, '_index')\n  let indexDefinition = {'index': {fields}}\n  return cozyFetchJSON(cozy, 'POST', path, indexDefinition)\n    .then((response) => {\n      const indexResult = { doctype: doctype, type: 'mango', name: response.id, fields }\n\n      if (response.result === 'exists') return indexResult\n\n      // indexes might not be usable right after being created; so we delay the resolving until they are\n      const selector = {}\n      selector[fields[0]] = {'$gt': null}\n\n      const opts = getV3Options(indexResult, {'selector': selector})\n      let path = createPath(cozy, false, indexResult.doctype, '_find')\n      return cozyFetchJSON(cozy, 'POST', path, opts)\n      .then(() => indexResult)\n      .catch(() => { // one retry\n        return sleep(1000)\n        .then(() => cozyFetchJSON(cozy, 'POST', path, opts))\n        .then(() => indexResult)\n        .catch(() => {\n          return sleep(500).then(() => indexResult)\n        })\n      })\n    })\n}\n\n// queryV2 is equivalent to query but only works for V2.\n// It transforms the query into a _views call using makeMapReduceQuery\nfunction queryV2 (cozy, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error('query indexRef should be the return value of defineIndexV2')\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v2')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  return cozyFetchJSON(cozy, 'POST', path, opts)\n    .then((response) => response.map(r => r.value))\n}\n\n// queryV3 is equivalent to query but only works for V3\nfunction queryV3 (cozy, indexRef, options) {\n  const opts = getV3Options(indexRef, options)\n\n  let path = createPath(cozy, false, indexRef.doctype, '_find')\n  return cozyFetchJSON(cozy, 'POST', path, opts)\n    .then((response) => options.wholeResponse ? response : response.docs)\n}\n\nfunction getV3Options (indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV3')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    skip: options.skip,\n    since: options.since,\n    sort: options.sort\n  }\n\n  if (options.descending) {\n    opts.sort = indexRef.fields.map(f => ({ [f]: 'desc' }))\n  }\n\n  return opts\n}\n\n// misc\nfunction capitalize (name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction (doctype, fields) {\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace('DOCTYPEPLACEHOLDER', doctype.toLowerCase())\n                     .replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector (selector, path = [], operator = '$eq') {\n  if ((typeof selector) !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function (acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector (selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function (acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector (selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery (indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function (field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error('Selector on field ' + field + ', but not on ' + firstFreeValueField + ' which is higher in index fields.')\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function (field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error('Cant apply selector on ' + field + ', it is not in index')\n    }\n  })\n\n  if (query.descending) {\n    mrquery = {\n      descending: true,\n      reduce: false,\n      startkey: mrquery.endkey,\n      endkey: mrquery.startkey,\n      inclusive_end: mrquery.inclusive_end\n    }\n  }\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global Blob, File */\nimport { cozyFetch, cozyFetchJSON } from './fetch'\nimport jsonapi from './jsonapi'\nimport { DOCTYPE_FILES } from './doctypes'\n\n// global variables\nexport const ROOT_DIR_ID = 'io.cozy.files.root-dir'\nexport const TRASH_DIR_ID = 'io.cozy.files.trash-dir'\n\nconst contentTypeOctetStream = 'application/octet-stream'\n\nfunction sanitizeFileName (name) {\n  return name && name.trim()\n}\n\nfunction getFileTypeFromName (name) {\n  if (/\\.heic$/i.test(name)) return 'image/heic'\n  else if (/\\.heif$/i.test(name)) return 'image/heif'\n  else return null\n}\n\nfunction doUpload (cozy, data, method, path, options) {\n  if (!data) {\n    throw new Error('missing data argument')\n  }\n\n  // transform any ArrayBufferView to ArrayBuffer\n  if (data.buffer && data.buffer instanceof ArrayBuffer) {\n    data = data.buffer\n  }\n\n  const isBuffer = (typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer)\n  const isFile = (typeof File !== 'undefined' && data instanceof File)\n  const isBlob = (typeof Blob !== 'undefined' && data instanceof Blob)\n  const isStream = (data.readable === true && typeof data.pipe === 'function')\n  const isString = (typeof data === 'string')\n\n  if (!isBuffer && !isFile && !isBlob && !isStream && !isString) {\n    throw new Error('invalid data type')\n  }\n\n  let {contentType, contentLength, checksum, lastModifiedDate, ifMatch} = options || {}\n  if (!contentType) {\n    if (isBuffer) {\n      contentType = contentTypeOctetStream\n    } else if (isFile) {\n      contentType = data.type || getFileTypeFromName(data.name.toLowerCase()) || contentTypeOctetStream\n      if (!lastModifiedDate) {\n        lastModifiedDate = data.lastModifiedDate\n      }\n    } else if (isBlob) {\n      contentType = data.type || contentTypeOctetStream\n    } else if (isStream) {\n      contentType = contentTypeOctetStream\n    } else if (typeof data === 'string') {\n      contentType = 'text/plain'\n    }\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const headers = {\n    'Content-Type': contentType\n  }\n  if (contentLength) headers['Content-Length'] = String(contentLength)\n  if (checksum) headers['Content-MD5'] = checksum\n  if (lastModifiedDate) headers['Date'] = lastModifiedDate.toGMTString()\n  if (ifMatch) headers['If-Match'] = ifMatch\n\n  return cozyFetch(cozy, path, {\n    method: method,\n    headers: headers,\n    body: data\n  })\n    .then((res) => {\n      const json = res.json()\n      if (!res.ok) {\n        return json.then(err => { throw err })\n      } else {\n        return json.then(jsonapi)\n      }\n    })\n}\n\nexport function create (cozy, data, options) {\n  let {name, dirID, executable} = options || {}\n\n  // handle case where data is a file and contains the name\n  if (!name && typeof data.name === 'string') {\n    name = data.name\n  }\n\n  name = sanitizeFileName(name)\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (executable === undefined) {\n    executable = false\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=file&Executable=${executable}`\n  return doUpload(cozy, data, 'POST', `${path}${query}`, options)\n}\n\nexport function createDirectory (cozy, options) {\n  let {name, dirID, lastModifiedDate} = options || {}\n\n  name = sanitizeFileName(name)\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=directory`\n  return cozyFetchJSON(cozy, 'POST', `${path}${query}`, undefined, {\n    headers: {\n      'Date': lastModifiedDate ? lastModifiedDate.toGMTString() : ''\n    }\n  })\n}\n\nfunction getDirectoryOrCreate (cozy, name, parentDirectory) {\n  if (parentDirectory && !parentDirectory.attributes) throw new Error('Malformed parent directory')\n\n  name = sanitizeFileName(name)\n\n  const path = `${parentDirectory._id === ROOT_DIR_ID ? '' : parentDirectory.attributes.path}/${name}`\n\n  return cozy.files.statByPath(path || '/')\n    .catch(error => {\n      const parsedError = JSON.parse(error.message)\n      const errors = parsedError.errors\n      if (errors && errors.length && errors[0].status === '404') {\n        return cozy.files.createDirectory({\n          name: name,\n          dirID: parentDirectory && parentDirectory._id\n        })\n      }\n\n      throw errors\n    })\n}\n\nexport function createDirectoryByPath (cozy, path, offline) {\n  const parts = path.split('/').filter(part => part !== '')\n\n  const rootDirectoryPromise = cozy.files.statById(ROOT_DIR_ID, offline)\n\n  return parts.length\n    ? parts.reduce((parentDirectoryPromise, part) => {\n      return parentDirectoryPromise\n        .then(parentDirectory => getDirectoryOrCreate(cozy, part, parentDirectory))\n    }, rootDirectoryPromise)\n      : rootDirectoryPromise\n}\n\nexport function updateById (cozy, id, data, options) {\n  return doUpload(cozy, data, 'PUT', `/files/${encodeURIComponent(id)}`, options)\n}\n\nfunction doUpdateAttributes (cozy, attrs, path, options) {\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const {ifMatch} = options || {}\n  const body = {\n    data: {\n      attributes: Object.assign(\n        {},\n        attrs,\n        { name: sanitizeFileName(attrs.name) }\n      )\n    }\n  }\n  return cozyFetchJSON(cozy, 'PATCH', path, body, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nexport function updateAttributesById (cozy, id, attrs, options) {\n  return doUpdateAttributes(cozy, attrs,\n    `/files/${encodeURIComponent(id)}`, options)\n}\n\nexport function updateAttributesByPath (cozy, path, attrs, options) {\n  return doUpdateAttributes(cozy, attrs,\n    `/files/metadata?Path=${encodeURIComponent(path)}`, options)\n}\n\nexport function trashById (cozy, id, options) {\n  if (typeof id !== 'string' || id === '') {\n    throw new Error('missing id argument')\n  }\n  const {ifMatch} = options || {}\n  return cozyFetchJSON(cozy, 'DELETE', `/files/${encodeURIComponent(id)}`, undefined, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nexport function statById (cozy, id, offline = true, options = {}) {\n  if (offline && cozy.offline.hasDatabase(DOCTYPE_FILES)) {\n    let db = cozy.offline.getDatabase(DOCTYPE_FILES)\n    return Promise.all([\n      db.get(id),\n      db.find(Object.assign({ selector: { 'dir_id': id } }, options))\n    ]).then(([doc, children]) => {\n      if (id === ROOT_DIR_ID) {\n        children.docs = children.docs.filter(doc => doc._id !== TRASH_DIR_ID)\n      }\n      children = sortFiles(children.docs.map(doc => addIsDir(toJsonApi(cozy, doc))))\n      return addIsDir(toJsonApi(cozy, doc, children))\n    })\n  }\n  const query = Object.keys(options).length === 0 ? '' : `?${encodePageOptions(options)}`\n  return cozyFetchJSON(cozy, 'GET', `/files/${encodeURIComponent(id)}${query}`)\n    .then(addIsDir)\n}\n\nexport function statByPath (cozy, path) {\n  return cozyFetchJSON(cozy, 'GET', `/files/metadata?Path=${encodeURIComponent(path)}`)\n    .then(addIsDir)\n}\n\nexport function downloadById (cozy, id) {\n  return cozyFetch(cozy, `/files/download/${encodeURIComponent(id)}`)\n}\n\nexport function downloadByPath (cozy, path) {\n  return cozyFetch(cozy, `/files/download?Path=${encodeURIComponent(path)}`)\n}\n\nfunction extractResponseLinkRelated (res) {\n  let href = res.links && res.links.related\n  if (!href) throw new Error('No related link in server response')\n  return href\n}\n\nexport function getDownloadLinkByPath (cozy, path) {\n  return cozyFetchJSON(cozy, 'POST', `/files/downloads?Path=${encodeURIComponent(path)}`)\n    .then(extractResponseLinkRelated)\n}\n\nexport function getDownloadLinkById (cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/downloads?Id=${encodeURIComponent(id)}`)\n    .then(extractResponseLinkRelated)\n}\n\nexport function getFilePath (cozy, file = {}, folder) {\n  if (!folder || !folder.attributes) {\n    throw Error('Folder should be valid with an attributes.path property')\n  }\n\n  const folderPath = folder.attributes.path.endsWith('/')\n    ? folder.attributes.path\n      : `${folder.attributes.path}/`\n\n  return `${folderPath}${file.name}`\n}\n\nexport function getCollectionShareLink (cozy, id, collectionType) {\n  if (!id) {\n    return Promise.reject(Error('An id should be provided to create a share link'))\n  }\n  return cozyFetchJSON(cozy, 'POST', `/permissions?codes=email`, {\n    data: {\n      type: 'io.cozy.permissions',\n      attributes: {\n        permissions: {\n          files: {\n            type: 'io.cozy.files',\n            verbs: ['GET'],\n            values: [id],\n            selector: 'referenced_by'\n          },\n          collection: {\n            type: collectionType,\n            verbs: ['GET'],\n            values: [id]\n          }\n        }\n      }\n    }\n  }).then(data => ({sharecode: `sharecode=${data.attributes.codes.email}`, id: `id=${id}`}))\n}\n\nexport function getArchiveLinkByPaths (cozy, paths, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      files: paths\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, {data: archive})\n  .then(extractResponseLinkRelated)\n}\n\nexport function getArchiveLinkByIds (cozy, ids, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      ids: ids\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, {data: archive})\n  .then(extractResponseLinkRelated)\n}\n\nexport function listTrash (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/files/trash`)\n}\n\nexport function clearTrash (cozy) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash`)\n}\n\nexport function restoreById (cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nexport function destroyById (cozy, id, options) {\n  const {ifMatch} = options || {}\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash/${encodeURIComponent(id)}`, undefined, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nfunction addIsDir (obj) {\n  obj.isDir = obj.attributes.type === 'directory'\n  return obj\n}\n\nfunction encodePageOptions (options) {\n  let opts = []\n  for (const name in options) {\n    opts.push(`page[${encodeURIComponent(name)}]=${encodeURIComponent(options[name])}`)\n  }\n  return opts.join('&')\n}\n\nfunction toJsonApi (cozy, doc, contents = []) {\n  let clone = JSON.parse(JSON.stringify(doc))\n  delete clone._id\n  delete clone._rev\n  return {\n    _id: doc._id,\n    _rev: doc._rev,\n    _type: DOCTYPE_FILES,\n    attributes: clone,\n    relationships: {\n      contents: {\n        data: contents,\n        meta: {\n          count: contents.length\n        }\n      }\n    },\n    relations: (name) => {\n      if (name === 'contents') {\n        return contents\n      }\n    }\n  }\n}\n\nfunction sortFiles (allFiles) {\n  const folders = allFiles.filter(f => f.attributes.type === 'directory')\n  const files = allFiles.filter(f => f.attributes.type !== 'directory')\n  const sort = files => files.sort((a, b) => a.attributes.name.localeCompare(b.attributes.name))\n  return sort(folders).concat(sort(files))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/files.js","import {cozyFetchJSON} from './fetch'\n\nconst intentClass = 'coz-intent'\n\n// helper to serialize/deserialize an error for/from postMessage\nconst errorSerializer = (() => {\n  function mapErrorProperties (from, to) {\n    const result = Object.assign(to, from)\n    const nativeProperties = ['name', 'message']\n    return nativeProperties.reduce((result, property) => {\n      if (from[property]) {\n        to[property] = from[property]\n      }\n      return result\n    }, result)\n  }\n  return {\n    serialize: (error) => mapErrorProperties(error, {}),\n    deserialize: (data) => mapErrorProperties(data, new Error(data.message))\n  }\n})()\n\n// inject iframe for service in given element\nfunction injectService (url, element, intent, data, onReadyCallback) {\n  const document = element.ownerDocument\n  if (!document) throw new Error('Cannot retrieve document object from given element')\n\n  const window = document.defaultView\n  if (!window) throw new Error('Cannot retrieve window object from document')\n\n  const iframe = document.createElement('iframe')\n  // if callback provided for when iframe is loaded\n  if (typeof onReadyCallback === 'function') iframe.onload = onReadyCallback\n  // TODO: implement 'title' attribute\n  iframe.setAttribute('src', url)\n  iframe.classList.add(intentClass)\n  element.appendChild(iframe)\n  iframe.focus()\n\n  // Keeps only http://domain:port/\n  const serviceOrigin = url.split('/', 3).join('/')\n\n  return new Promise((resolve, reject) => {\n    let handshaken = false\n    const messageHandler = (event) => {\n      if (event.origin !== serviceOrigin) return\n\n      const eventType = event.data.type\n      if (eventType === 'load') {\n        // Safari 9.1 (At least) send a MessageEvent when the iframe loads,\n        // making the handshake fails.\n        console.warn && console.warn('Cozy Client ignored MessageEvent having data.type `load`.')\n        return\n      }\n\n      if (eventType === `intent-${intent._id}:ready`) {\n        handshaken = true\n        return event.source.postMessage(data, event.origin)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:resize`) {\n        ['width', 'height', 'maxWidth', 'maxHeight'].forEach(prop => {\n          if (event.data.transition) element.style.transition = event.data.transition\n          if (event.data.dimensions[prop]) element.style[prop] = `${event.data.dimensions[prop]}px`\n        })\n\n        return true\n      }\n\n      window.removeEventListener('message', messageHandler)\n      const removeIntentFrame = () => {\n        // check if the parent node has not been already removed from the DOM\n        iframe.parentNode && iframe.parentNode.removeChild(iframe)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:exposeFrameRemoval`) {\n        return resolve({removeIntentFrame, doc: event.data.document})\n      }\n\n      removeIntentFrame()\n\n      if (eventType === `intent-${intent._id}:error`) {\n        return reject(errorSerializer.deserialize(event.data.error))\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:cancel`) {\n        return resolve(null)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:done`) {\n        return resolve(event.data.document)\n      }\n\n      if (!handshaken) {\n        return reject(new Error('Unexpected handshake message from intent service'))\n      }\n\n      // We may be in a state where the messageHandler is still attached to then\n      // window, but will not be needed anymore. For example, the service failed\n      // before adding the `unload` listener, so no `intent:cancel` message has\n      // never been sent.\n      // So we simply ignore other messages, and this listener will stay here,\n      // waiting for a message which will never come, forever (almost).\n    }\n\n    window.addEventListener('message', messageHandler)\n  })\n}\n\nconst first = arr => arr && arr[0]\n\nexport function create (cozy, action, type, data = {}, permissions = []) {\n  if (!action) throw new Error(`Misformed intent, \"action\" property must be provided`)\n  if (!type) throw new Error(`Misformed intent, \"type\" property must be provided`)\n\n  const createPromise = cozyFetchJSON(cozy, 'POST', '/intents', {\n    data: {\n      type: 'io.cozy.intents',\n      attributes: {\n        action: action,\n        type: type,\n        data: data,\n        permissions: permissions\n      }\n    }\n  })\n\n  createPromise.start = (element, onReadyCallback) => {\n    return createPromise.then(intent => {\n      const filterServices = data.filterServices\n      const restData = Object.assign({}, data)\n      delete restData.filterServices\n\n      const services = intent.attributes.services\n      const filteredServices = filterServices\n        ? (services || []).filter(filterServices)\n        : services\n      const service = first(filteredServices)\n\n      if (!service) {\n        return Promise.reject(new Error('Unable to find a service'))\n      }\n\n      return injectService(service.href, element, intent, restData, onReadyCallback)\n    })\n  }\n\n  return createPromise\n}\n\nfunction listenClientData (intent, window) {\n  return new Promise((resolve, reject) => {\n    const messageEventListener = (event) => {\n      if (event.origin !== intent.attributes.client) return\n\n      window.removeEventListener('message', messageEventListener)\n      resolve(event.data)\n    }\n\n    window.addEventListener('message', messageEventListener)\n    window.parent.postMessage({\n      type: `intent-${intent._id}:ready`\n    }, intent.attributes.client)\n  })\n}\n\n// returns a service to communicate with intent client\nexport function createService (cozy, intentId, serviceWindow) {\n  serviceWindow = serviceWindow || typeof window !== 'undefined' && window\n  if (!serviceWindow) throw new Error('Intent service should be used in browser')\n\n  intentId = intentId || serviceWindow.location.search.split('=')[1]\n  if (!intentId) throw new Error('Cannot retrieve intent from URL')\n\n  return cozyFetchJSON(cozy, 'GET', `/intents/${intentId}`)\n    .then(intent => {\n      let terminated = false\n\n      const terminate = (message) => {\n        if (terminated) throw new Error('Intent service has already been terminated')\n        terminated = true\n        serviceWindow.parent.postMessage(message, intent.attributes.client)\n      }\n\n      const resizeClient = (dimensions, transitionProperty) => {\n        if (terminated) throw new Error('Intent service has been terminated')\n\n        const message = {\n          type: `intent-${intent._id}:resize`,\n          // if a dom element is passed, calculate its size\n          dimensions: dimensions.element\n            ? Object.assign({}, dimensions, {\n              maxHeight: dimensions.element.clientHeight,\n              maxWidth: dimensions.element.clientWidth\n            })\n              : dimensions,\n          transition: transitionProperty\n        }\n\n        serviceWindow.parent.postMessage(message, intent.attributes.client)\n      }\n\n      const cancel = () => {\n        terminate({type: `intent-${intent._id}:cancel`})\n      }\n\n      // Prevent unfulfilled client promises when this window unloads for a\n      // reason or another.\n      serviceWindow.addEventListener('unload', () => {\n        if (!terminated) cancel()\n      })\n\n      return listenClientData(intent, serviceWindow)\n        .then(data => {\n          return {\n            getData: () => data,\n            getIntent: () => intent,\n            terminate: (doc) => {\n              const eventName = (data && data.exposeIntentFrameRemoval\n                ? 'exposeFrameRemoval' : 'done'\n              )\n              return terminate({\n                type: `intent-${intent._id}:${eventName}`,\n                document: doc\n              })\n            },\n            throw: error => terminate({\n              type: `intent-${intent._id}:error`,\n              error: errorSerializer.serialize(error)\n            }),\n            resizeClient: resizeClient,\n            cancel: cancel\n          }\n        })\n    })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents.js","import {cozyFetchJSON} from './fetch'\n\nexport function count (cozy, workerType) {\n  return cozyFetchJSON(cozy, 'GET', `/jobs/queue/${workerType}`)\n    .then(data => data.length)\n}\n\nexport function queued (cozy, workerType) {\n  return cozyFetchJSON(cozy, 'GET', `/jobs/queue/${workerType}`)\n}\n\nexport function create (cozy, workerType, args, options) {\n  return cozyFetchJSON(cozy, 'POST', `/jobs/queue/${workerType}`, {\n    data: {\n      type: 'io.cozy.jobs',\n      attributes: {\n        arguments: args || {},\n        options: options || {}\n      }\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jobs.js","/* global pouchdbAdapterCordovaSqlite */\nimport {DOCTYPE_FILES} from './doctypes'\nimport {refreshToken} from './auth_v3'\nimport {isOffline} from './utils'\nimport PouchDB from 'pouchdb'\nimport pouchdbFind from 'pouchdb-find'\n\nexport const replicationOfflineError = 'Replication abort, your device is actually offline.'\n\nlet pluginLoaded = false\n\n/*\n  For each doctype we have some parameters:\n  cozy._offline[doctype] = {\n    database: pouchdb database\n    replication: the pouchdb replication\n    replicationPromise: promise of replication\n    interval: repeated replication interval\n  }\n*/\n\nexport function init (cozy, { options = {}, doctypes = [] }) {\n  for (let doctype of doctypes) {\n    createDatabase(cozy, doctype, options)\n  }\n}\n\n// helper\n\nfunction getInfo (cozy, doctype) {\n  cozy._offline = cozy._offline || []\n  cozy._offline[doctype] = cozy._offline[doctype] || {}\n  return cozy._offline[doctype]\n}\n\nexport function getDoctypes (cozy) {\n  cozy._offline = cozy._offline || []\n  return Object.keys(cozy._offline)\n}\n\n//\n// DATABASE\n//\n\nexport function hasDatabase (cozy, doctype) {\n  return getDatabase(cozy, doctype) !== undefined\n}\n\nexport function getDatabase (cozy, doctype) {\n  return getInfo(cozy, doctype).database\n}\n\nexport function setDatabase (cozy, doctype, database) {\n  cozy._offline[doctype].database = database\n  return getDatabase(cozy, doctype)\n}\n\nexport function createDatabase (cozy, doctype, options = {}) {\n  if (!pluginLoaded) {\n    PouchDB.plugin(pouchdbFind)\n    if (typeof pouchdbAdapterCordovaSqlite !== 'undefined') PouchDB.plugin(pouchdbAdapterCordovaSqlite)\n    pluginLoaded = true\n  }\n\n  if (hasDatabase(cozy, doctype)) {\n    return Promise.resolve(getDatabase(cozy, doctype))\n  }\n\n  setDatabase(cozy, doctype, new PouchDB(doctype, options))\n  return createIndexes(cozy, doctype).then(() => getDatabase(cozy, doctype))\n}\n\nexport function destroyDatabase (cozy, doctype) {\n  if (!hasDatabase(cozy, doctype)) {\n    return Promise.resolve(false)\n  }\n\n  return stopRepeatedReplication(cozy, doctype)\n    .then(() => stopReplication(cozy, doctype))\n    .then(() => getDatabase(cozy, doctype).destroy())\n    .then(response => {\n      setDatabase(cozy, doctype, undefined)\n      return response\n    })\n}\n\nexport function destroyAllDatabase (cozy) {\n  const doctypes = getDoctypes(cozy)\n  const destroy = (doctype) => destroyDatabase(cozy, doctype)\n  return Promise.all(doctypes.map(destroy))\n}\n\nfunction createIndexes (cozy, doctype) {\n  if (doctype === DOCTYPE_FILES) {\n    return getDatabase(cozy, doctype).createIndex({index: {fields: ['dir_id']}})\n  }\n  return Promise.resolve()\n}\n\n//\n// REPLICATION\n//\n\nexport function hasReplication (cozy, doctype) {\n  return getReplication(cozy, doctype) !== undefined\n}\n\nfunction getReplication (cozy, doctype) {\n  return getInfo(cozy, doctype).replication\n}\n\nfunction setReplication (cozy, doctype, replication) {\n  cozy._offline[doctype].replication = replication\n  return getReplication(cozy, doctype)\n}\n\nfunction getReplicationUrl (cozy, doctype) {\n  return cozy.authorize()\n    .then(credentials => {\n      const basic = credentials.token.toBasicAuth()\n      return (cozy._url + '/data/' + doctype).replace('//', `//${basic}`)\n    })\n}\n\nfunction getReplicationPromise (cozy, doctype) {\n  return getInfo(cozy, doctype).replicationPromise\n}\n\nfunction setReplicationPromise (cozy, doctype, promise) {\n  cozy._offline[doctype].replicationPromise = promise\n  return getReplicationPromise(cozy, doctype)\n}\n\nexport function replicateFromCozy (cozy, doctype, options = {}) {\n  return setReplicationPromise(cozy, doctype, new Promise((resolve, reject) => {\n    if (!hasDatabase(cozy, doctype)) {\n      createDatabase(cozy, doctype)\n    }\n    if (options.live === true) {\n      return reject(new Error('You can\\'t use `live` option with Cozy couchdb.'))\n    }\n\n    if (isOffline()) {\n      reject(replicationOfflineError)\n      options.onError && options.onError(replicationOfflineError)\n      return\n    }\n\n    getReplicationUrl(cozy, doctype)\n      .then(url => setReplication(cozy, doctype,\n        getDatabase(cozy, doctype).replicate.from(url, options).on('complete', (info) => {\n          setReplication(cozy, doctype, undefined)\n          resolve(info)\n          options.onComplete && options.onComplete(info)\n        }).on('error', (err) => {\n          if (err.error === 'code=400, message=Expired token') {\n            cozy.authorize().then(({client, token}) => {\n              refreshToken(cozy, client, token)\n                .then((newToken) => cozy.saveCredentials(client, newToken))\n                .then((credentials) => replicateFromCozy(cozy, doctype, options))\n            })\n          } else {\n            console.warn(`ReplicateFromCozy '${doctype}' Error:`)\n            console.warn(err)\n            setReplication(cozy, doctype, undefined)\n            reject(err)\n            options.onError && options.onError(err)\n          }\n        })\n      ))\n  }))\n}\n\nexport function stopReplication (cozy, doctype) {\n  if (!getDatabase(cozy, doctype) || !hasReplication(cozy, doctype)) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    try {\n      getReplicationPromise(cozy, doctype).then(() => {\n        resolve()\n      })\n      getReplication(cozy, doctype).cancel()\n      // replication is set to undefined by complete replication\n    } catch (e) {\n      resolve()\n    }\n  })\n}\n\nexport function stopAllReplication (cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = (doctype) => stopReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n//\n// REPEATED REPLICATION\n//\n\nfunction getRepeatedReplication (cozy, doctype) {\n  return getInfo(cozy, doctype).interval\n}\n\nfunction setRepeatedReplication (cozy, doctype, interval) {\n  cozy._offline[doctype].interval = interval\n}\n\nexport function hasRepeatedReplication (cozy, doctype) {\n  return getRepeatedReplication(cozy, doctype) !== undefined\n}\n\nexport function startRepeatedReplication (cozy, doctype, timer, options = {}) {\n  // TODO: add timer limitation for not flooding Gozy\n  if (hasRepeatedReplication(cozy, doctype)) {\n    return getRepeatedReplication(cozy, doctype)\n  }\n\n  return setRepeatedReplication(cozy, doctype, setInterval(() => {\n    if (isOffline()) {\n      // network is offline, replication cannot be launched\n      console.info(replicationOfflineError)\n      return\n    }\n    if (!hasReplication(cozy, doctype)) {\n      replicateFromCozy(cozy, doctype, options)\n      // TODO: add replicationToCozy\n    }\n  }, timer * 1000))\n}\n\nexport function stopRepeatedReplication (cozy, doctype) {\n  if (hasRepeatedReplication(cozy, doctype)) {\n    clearInterval(getRepeatedReplication(cozy, doctype))\n    setRepeatedReplication(cozy, doctype, undefined)\n  }\n  if (hasReplication(cozy, doctype)) {\n    return stopReplication(cozy, doctype)\n  }\n\n  return Promise.resolve()\n}\n\nexport function stopAllRepeatedReplication (cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = (doctype) => stopRepeatedReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/offline.js","module.exports = require(\"pouchdb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"pouchdb-find\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb-find\"\n// module id = 20\n// module chunks = 0","import {cozyFetchJSON} from './fetch'\n\nexport function diskUsage (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/disk-usage`)\n}\n\nexport function changePassphrase (cozy, currentPassPhrase, newPassPhrase) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/passphrase`, {\n    current_passphrase: currentPassPhrase,\n    new_passphrase: newPassPhrase\n  })\n}\n\nexport function getInstance (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/instance`)\n}\n\nexport function updateInstance (cozy, instance) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/instance`, instance)\n}\n\nexport function getClients (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/clients`)\n}\n\nexport function deleteClientById (cozy, id) {\n  return cozyFetchJSON(cozy, 'DELETE', `/settings/clients/${id}`)\n}\n\nexport function updateLastSync (cozy) {\n  return cozyFetchJSON(cozy, 'POST', '/settings/synchronized')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings.js","import { cozyFetchJSON, cozyFetchRawJSON } from './fetch'\nimport { DOCTYPE_FILES } from './doctypes'\n\nfunction updateRelations (verb) {\n  return function (cozy, doc, ids) {\n    if (!doc) throw new Error('missing doc argument')\n    if (!Array.isArray(ids)) ids = [ids]\n\n    const refs = ids.map((id) => ({type: DOCTYPE_FILES, id}))\n\n    return cozyFetchJSON(cozy, verb, makeReferencesPath(doc), {data: refs})\n  }\n}\n\nexport const addReferencedFiles = updateRelations('POST')\nexport const removeReferencedFiles = updateRelations('DELETE')\n\nexport function listReferencedFiles (cozy, doc) {\n  if (!doc) throw new Error('missing doc argument')\n  return cozyFetchJSON(cozy, 'GET', makeReferencesPath(doc))\n    .then((files) => files.map((file) => file._id))\n}\n\nexport function fetchReferencedFiles (cozy, doc, options) {\n  if (!doc) throw new Error('missing doc argument')\n  const params = Object.keys(options).map(key => `&page[${key}]=${options[key]}`).join('')\n  // As datetime is the only sort option available, I see no reason to not have it by default\n  return cozyFetchRawJSON(cozy, 'GET', `${makeReferencesPath(doc)}?include=files&sort=datetime${params}`)\n}\n\nfunction makeReferencesPath (doc) {\n  const type = encodeURIComponent(doc._type)\n  const id = encodeURIComponent(doc._id)\n  return `/data/${type}/${id}/relationships/references`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/relations.js"],"sourceRoot":""}